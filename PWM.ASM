LIST P=16F877, F=INHX8M
INCLUDE<P16F877.INC>
INCLUDE<P16BITS.INC>

__CONFIG 3FF9H;

NUMH 	EQU 21H
NUML	EQU 20H
TEMP	EQU 22H
COUNTER	EQU 23H
VAR 	EQU 24H
CONST 	EQU 25H

VAR1 	EQU 26H
VAR2 	EQU 27H
VAR16	EQU 30H

TEST1	EQU 28H
TEST2	EQU 29H

ORG 0H 
GOTO WEEE


WEEE	
		MOVLW B'10000001'	
		MOVWF ADCON0
		BANKSEL ADCON1
		MOVLW B'10000101'
		MOVWF ADCON1
		BANKSEL ADCON0
	
		BANKSEL TRISA
		CLRF TRISC
		CLRF TRISB
		MOVLW 0FFH
		MOVWF TRISD
		MOVLW 04H
		MOVWF OPTION_REG
		
		BANKSEL PORTA

MAIN	
		
		CALL READ_ADC
		MOVFW NUMH
		MOVWF PORTB
		
		BTFSS PORTB, 7
		GOTO MAIN
		CALL PWM3
		GOTO MAIN



PWM1:
		BANKSEL PR2
		MOVLW 0CFH			;B'11001111'
		MOVWF PR2
		BANKSEL T2CON
		MOVLW 07H			;B'00000111'
		MOVWF T2CON
		MOVLW 67H			;B'01100111'
		MOVWF CCPR1L
		MOVLW 3CH			;B'00111100'
		MOVWF CCP1CON	
	
		RETURN

PWM2:
		BANKSEL PR2
		MOVLW 58H			;B'01011000'
		MOVWF PR2
		BANKSEL T2CON
		MOVLW 07H			;B'00000111'
		MOVWF T2CON
		MOVLW 3EH			;B'00111110'
		MOVWF CCPR1L
		MOVLW 1CH			;B'00011100'
		MOVWF CCP1CON
		
		RETURN

PWM3:
		BANKSEL PR2
		MOVLW 0F9H			;B'11111001'
		MOVWF PR2
		BANKSEL T2CON
		MOVLW 05H			;B'00000101'
		MOVWF T2CON
		MOVLW 0FCH			;B'11111100'
		MOVWF CCPR1L
		MOVLW 3CH			;B'00111100'
		MOVWF CCP1CON
		RETURN

PWMWALA
		
		BANKSEL CCPR1L
		MOVLW B'00000000'
		MOVWF CCPR1L
		MOVWF CCPR1H
		MOVWF CCP1CON
		RETURN
		

READ_ADC

		BSF ADCON0, GO_DONE
		BTFSC ADCON0, GO_DONE
		GOTO $-1
		MOVF ADRESH, W
		MOVWF NUMH
		BANKSEL ADRESL
		MOVF ADRESL, W
		ANDLW 00H
		BANKSEL ADRESH
		MOVWF NUML


		INIT16 VAR1, 0H

		MOVF ADRESH, W
		ANDLW 03H
		MOVWF VAR1

		MOVLW D'8'
		MOVWF COUNTER
SHIFT	LSL16 VAR1
		DECFSZ COUNTER
		GOTO SHIFT
		RLF VAR1

		MOVF ADRESL, W
		MOVWF VAR1
	
		RETURN
	
	

END